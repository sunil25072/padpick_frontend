<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="../Css/profile.css">
</head>
<body>

<header class="header">
    <h1 class="logo">My Profile</h1>
    <nav class="navbar">
        <ul>
            <li><a href="./home.html">Home</a></li>
            <li><a href="./Areas.html">Areas</a></li>
            <li><a href="./profile.html" class="active">Profile</a></li>
        </ul>
    </nav>
</header>

<main class="profile-container">
    <div class="profile-card">

        <!-- ðŸ”¥ PROFILE IMAGE -->
        <img
            id="profileImg"
            src="/Asset/profile.jpg"
            alt="Profile Image"
            class="profile-img"
        >

        <h2 id="username">Loading...</h2>
        <p class="email" id="email">Loading...</p>

        <div class="profile-info">
            <p><strong>Phone:</strong> <span id="mobile">Loading...</span></p>
            <p><strong>Location:</strong> <span id="location">Loading...</span></p>
        </div>

        <button class="edit-btn">
            <a class="love" href="./Edit_profile.html">Edit Profile</a>
        </button>

        <button class="edit-btn">
            <a class="love" href="./property.html">Post Property</a>
        </button>

        <button class="edit-btn">
            <a class="love" href="./my_property.html">See your Property</a>
        </button>

        <button class="edit-btns" id="deleteBtn">
            <a class="love">Delete Profile</a>
        </button>

        <p id="message" style="color:red;text-align:center;"></p>

    </div>
</main>

<footer id="copy">
    <p>&copy;2025 Padpick. All rights Reserved</p>
</footer>

<script>
    const userId = localStorage.getItem("user_id");
    const message = document.getElementById("message");

    if (!userId) {
        message.innerText = "Please login again";
    } else {
        loadProfile();
    }

    document
        .getElementById("deleteBtn")
        .addEventListener("click", deleteProfile);

    async function loadProfile() {
        try {
            const res = await fetch(
                `http://localhost:8000/users/${userId}/profile`
            );

            const data = await res.json();

            if (!res.ok) {
                message.innerText =
                    data.detail || "Failed to load profile";
                return;
            }

            document.getElementById("username").innerText =
                data.username;
            document.getElementById("email").innerText =
                data.email;
            document.getElementById("mobile").innerText =
                data.mobile_number || "-";
            document.getElementById("location").innerText =
                data.location || "-";

            document.getElementById("profileImg").src =
                data.profile_image || "../../Asset/Spider-Man & Gwen Aesthetic_.jpg";

        } catch (error) {
            message.innerText = "Backend not reachable";
        }
    }

    async function deleteProfile() {
        const confirmDelete = confirm(
            "Are you sure you want to delete your profile?"
        );

        if (!confirmDelete) return;

        try {
            const res = await fetch(
                `http://localhost:8000/users/${userId}`,
                { method: "DELETE" }
            );

            const data = await res.json();

            if (!res.ok) {
                message.innerText =
                    data.detail || "Delete failed";
                return;
            }

            alert("Profile deleted successfully");
            localStorage.removeItem("user_id");
            window.location.href = "../../index.html";

        } catch (error) {
            message.innerText = "Backend not reachable";
        }
    }
</script>

</body>
</html>
