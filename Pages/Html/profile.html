<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile ‚Äî PadPick</title>
    <link rel="icon" href="/Asset/Screenshot_2026-02-10_215817-removebg-preview.png" type="image/x-icon">
    <link rel="stylesheet" href="../Css/profile.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">

</head>
<body>

<header>
    <a class="logo" href="./home.html">Pad<span>Pick</span></a>
    <nav class="navbar">
        <ul>
            <li><a href="./home.html">Home</a></li>
            <li><a href="./Areas.html">Areas</a></li>
            <li><a href="./profile.html" class="active">Profile</a></li>
        </ul>
    </nav>
</header>

<main>
    <div class="profile-card">

        <div class="card-banner"></div>

        <div class="avatar-wrap">
            <img
                id="profileImg"
                src="../../Asset/profile.jpg"
                alt="Profile Image"
                class="profile-img">
        </div>

        <div class="card-body">
            <h2 id="username">Loading...</h2>
            <p class="email" id="email">Loading...</p>

            <div class="info-grid">
                <div class="info-tile">
                    <div class="tile-label">Phone</div>
                    <div class="tile-value" id="mobile">‚Äî</div>
                </div>
                <div class="info-tile">
                    <div class="tile-label">Location</div>
                    <div class="tile-value" id="location">‚Äî</div>
                </div>
            </div>

            <hr class="divider">

            <div class="btn-group">
                <button class="edit-btn">
                    <a class="love" href="./Edit_profile.html">Edit Profile</a>
                </button>
                <button class="edit-btn">
                    <a class="love" href="./property.html">Post Property</a>
                </button>
                <button class="edit-btn">
                    <a class="love" href="./user_property.html">See your Property</a>
                </button>
            </div>

            <div class="danger-zone">
                <button class="btn-danger" id="logout">Log Out</button>
                <button class="btn-danger" id="deleteBtn">Delete Profile</button>
            </div>

            <p id="message"></p>
        </div>

    </div>
</main>

<footer>
    &copy; 2025 <span>PadPick</span>. All rights reserved.
</footer>

<script>
const userId = localStorage.getItem("user_id");
const message = document.getElementById("message");

//  Login check
if (!userId) {
    message.innerText = "Please login again";
} else {
    loadProfile();
}

// üîì Logout
document.getElementById("logout").addEventListener("click", () => {
    if (!confirm("Do you want to logout?")) return;

    localStorage.removeItem("user_id");
    window.location.href = "../../index.html";
});

// ‚ùå Delete profile
document.getElementById("deleteBtn").addEventListener("click", deleteProfile);

// üì• Load profile
    async function loadProfile() {
        try {
            const res = await fetch(
                `https://padpick-backend.vercel.app/users/${userId}/profile`

            );

        const data = await res.json();

        if (!res.ok) {
            message.innerText = data.detail || "Failed to load profile";
            return;
        }

        document.getElementById("username").innerText = data.username || "-";
        document.getElementById("email").innerText = data.email || "-";
        document.getElementById("mobile").innerText = data.mobile_number || "-";
        document.getElementById("location").innerText = data.location || "-";

        const profileImg = document.getElementById("profileImg");
        if (data.profile_img) {
            profileImg.src = data.profile_img + "?v=" + Date.now();
        } else {
            profileImg.src = "../../Asset/profile.jpg";
        }

    } catch (err) {
        message.innerText = "Backend not reachable";
    }
}

// üóëÔ∏è Delete profile function
async function deleteProfile() {
    if (!confirm("Are you sure you want to delete your profile?")) return;

    try {
        const res = await fetch(
            `https://padpick-backend.vercel.app/users/${userId}`,
            { method: "DELETE" }
        );

        if (res.ok) {
            localStorage.removeItem("user_id");
            window.location.href = "../../index.html";
        } else {
            message.innerText = "Failed to delete profile";
        }
    } catch (err) {
        message.innerText = "Server error";
    }
}
</script>

</body>
</html> 