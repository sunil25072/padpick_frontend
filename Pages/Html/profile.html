<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="icon" href="/Asset/Screenshot_2026-02-10_215817-removebg-preview.png" type="image/x-icon">
    <link rel="stylesheet" href="../Css/profile.css">
</head>
<body>

<header class="header">
    <h1 class="logo">My Profile</h1>
    <nav class="navbar">
        <ul>
            <li><a href="./home.html">Home</a></li>
            <li><a href="./Areas.html">Areas</a></li>
            <li><a href="./profile.html" class="active">Profile</a></li>
        </ul>
    </nav>
</header>

<main class="profile-container">
    <div class="profile-card">

        <img
            id="profileImg"
            src="../../Asset/profile.jpg"
            alt="Profile Image"
            class="profile-img"
        >

        <h2 id="username">Loading...</h2>
        <p class="email" id="email">Loading...</p>

        <div class="profile-info">
            <p><strong>Phone:</strong> <span id="mobile">Loading...</span></p>
            <p><strong>Location:</strong> <span id="location">Loading...</span></p>
        </div>

        <button class="edit-btn">
            <a class="love" href="./Edit_profile.html">Edit Profile</a>
        </button>

        <button class="edit-btn">
            <a class="love" href="./property.html">Post Property</a>
        </button>

        <button class="edit-btn">
            <a class="love" href="./user_property.html">See your Property</a>
        </button>

        <!--  LOGOUT -->
        <button class="edit-btns" id="logout">Log Out</button>

        <!--  DELETE -->
        <button class="edit-btns" id="deleteBtn">Delete Profile</button>

        <p id="message" style="color:red;text-align:center;"></p>

    </div>
</main>

<footer id="copy">
    <p>&copy;2025 Padpick. All rights Reserved</p>
</footer>

<script>
const userId = localStorage.getItem("user_id");
const message = document.getElementById("message");

//  Login check
if (!userId) {
    message.innerText = "Please login again";
} else {
    loadProfile();
}

// üîì Logout
document.getElementById("logout").addEventListener("click", () => {
    if (!confirm("Do you want to logout?")) return;

    localStorage.removeItem("user_id");
    window.location.href = "../../index.html";
});

// ‚ùå Delete profile
document.getElementById("deleteBtn").addEventListener("click", deleteProfile);

// üì• Load profile
    async function loadProfile() {
        try {
            const res = await fetch(
                `https://padpick-backend.vercel.app/users/${userId}/profile`

            );

        const data = await res.json();

        if (!res.ok) {
            message.innerText = data.detail || "Failed to load profile";
            return;
        }

        document.getElementById("username").innerText = data.username || "-";
        document.getElementById("email").innerText = data.email || "-";
        document.getElementById("mobile").innerText = data.mobile_number || "-";
        document.getElementById("location").innerText = data.location || "-";

        const profileImg = document.getElementById("profileImg");
        if (data.profile_img) {
            profileImg.src = data.profile_img + "?v=" + Date.now();
        } else {
            profileImg.src = "../../Asset/profile.jpg";
        }

    } catch (err) {
        message.innerText = "Backend not reachable";
    }
}

// üóëÔ∏è Delete profile function
async function deleteProfile() {
    if (!confirm("Are you sure you want to delete your profile?")) return;

    try {
        const res = await fetch(
            `https://padpick-backend.vercel.app/users/${userId}`,
            { method: "DELETE" }
        );

        if (res.ok) {
            localStorage.removeItem("user_id");
            window.location.href = "../../index.html";
        } else {
            message.innerText = "Failed to delete profile";
        }
    } catch (err) {
        message.innerText = "Server error";
    }
}
</script>

</body>
</html>
