<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Property</title>
    <link rel="stylesheet" href="../Css/property.css">
</head>
<body>

    <!-- Header -->
    <header class="header">
        <h1 class="logo">Padpick</h1>

        <nav class="navbar">
            <ul>
                <li><a href="./home.html">Home</a></li>
                <li><a href="./Areas.html">Areas</a></li>
                <li><a href="./profile.html">Profile</a></li>
            </ul>
        </nav>
    </header>

    <!-- Post Property Form -->
    <main class="form-container">
        <div class="form-card">
            <h2>Post Your Property</h2>

<form
  id="propertyForm"
  action="http://127.0.0.1:8000/homes/add"
  method="post"
  enctype="multipart/form-data"
>

  <input type="text" name="name" placeholder="Surya's Home" required>

  <input type="tel" name="contact_number" placeholder="Mobile number" required>

  <input type="number" name="price" placeholder="â‚¹ Amount" required>

  <select name="area_id" required>
    <option value="">Select Area</option>
    <option value="1">Anna Nagar</option>
    <option value="2">Perungudi</option>
    <option value="3">T - Nagar</option>
    <option value="4">Velachery</option>
  </select>

  <textarea name="address" placeholder="No:9, Velachery"></textarea>

  <!-- ðŸ”¥ MAIN IMAGE SOURCE -->
  <label>Upload House Images</label>
  <input type="file" name="house_images" multiple required>

  <label>Upload Kitchen Images</label>
  <input type="file" name="kitchen_images" multiple>

  <label>Upload Bathroom Images</label>
  <input type="file" name="bathroom_images" multiple>

  <label>Upload Hall Images</label>
  <input type="file" name="hall_images" multiple>

  <button type="submit">Post Property</button>
</form>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 Padpick. All rights reserved.</p>
    </footer>

</body>
<script>
const form = document.getElementById("propertyForm");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const userId = localStorage.getItem("user_id");
  if (!userId) {
    alert("Please login again");
    return;
  }

  const formData = new FormData(form);

  // ðŸ”¥ attach user_id
  formData.append("user_id", userId);

  try {
    const res = await fetch("http://localhost:8000/homes/add", {
      method: "POST",
      body: formData
    });

    const data = await res.json();

    if (!res.ok) {
      alert(data.detail || "Property upload failed");
      return;
    }
    alert("Property posted successfully ðŸŽ‰");

    // ðŸ”¥ DIRECTLY GO TO HOME DETAILS PAGE WITH home_id
    window.location.href = `./Pg&Areas.html?home_id=${data.home_id}`;

  } catch (err) {
    alert("Backend not reachable");
  }
});
</script>
</html>
