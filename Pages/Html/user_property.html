<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Properties</title>
    <link rel="icon" href="/Asset/Screenshot_2026-02-10_215817-removebg-preview.png" type="image/x-icon">
    <link rel="stylesheet" href="../Css/subareas.css">
</head>
<body>

<!-- HEADER -->
<header>
    <h1>Padpick</h1>
    <nav class="navbar">
        <ul>
            <li><a href="./home.html">Home</a></li>
            <li><a href="./Areas.html">Areas</a></li>
            <li><a href="./profile.html">Profile</a></li>
        </ul>
    </nav>
</header>

<div class="container">
    <div id="areaTitle" class="title">My Properties</div>

    <div id="pgList" class="pg-list"></div>

    <div id="msg" class="message"></div>
</div>

<footer>
    &copy; 2025 Padpick. All rights reserved.
</footer>

<!-- ================= JS ================= -->
<script>
const userId = localStorage.getItem("user_id");
const list = document.getElementById("pgList");
const msg = document.getElementById("msg");

if (!userId) {
    msg.innerText = "Please login again";
} else {
    loadMyProperties();
}

function loadMyProperties() {
    list.innerHTML = "";
    msg.innerText = "";

    fetch(`https://padpick-backend.vercel.app/homes/by-user/${userId}`)
        .then(res => res.json())
        .then(data => {

            if (!Array.isArray(data) || data.length === 0) {
                msg.innerText = "You have not posted any property yet";
                return;
            }

            data.forEach(home => {
                list.innerHTML += `
                    <div class="pg-card">
                        <img src="${home.img1}" alt="${home.name}">

                        <div class="content">
                            <h3>${home.name}</h3>
                            <p>₹ ${home.price} / month</p>

                            <div class="action-buttons">
                                <a href="./Edit_property.html?home_id=${home.id}" class="btn edit-btn">
                                    Edit
                                </a>

                                <button class="btn delete-btn" onclick="deleteHome(${home.id})">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
        })
        .catch(err => {
            console.error(err);
            msg.innerText = "Backend not reachable";
        });
}

function deleteHome(homeId) {
    if (!confirm("Are you sure you want to delete this property?")) return;

    fetch(`https://padpick-backend.vercel.app/homes/${homeId}`, {
        method: "DELETE"
    })
    .then(res => res.json())
    .then(() => {
        alert("Property deleted successfully ✅");
        loadMyProperties();
    })
    .catch(err => {
        console.error(err);
        alert("Delete failed ❌");
    });
}
</script>

</body>
</html>
